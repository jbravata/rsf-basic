{"version":3,"sources":["../../src/router/powerLinkHandler.js"],"names":["powerLinkHandler","_params","request","response","set","src","protocol","hostname","indexOf","port","send"],"mappings":"AAAA;;;;AAIA,eAAe,SAASA,gBAAT,CAA0BC,OAA1B,EAAmCC,OAAnC,EAA4CC,QAA5C,EAAsD;AACnEA,EAAAA,QAAQ,CAACC,GAAT,CAAa,cAAb,EAA6B,wBAA7B;AAEA,MAAMC,GAAG,aAAMH,OAAO,CAACI,QAAd,eAA2BJ,OAAO,CAACK,QAAnC,SACP,CAAC,EAAD,EAAK,GAAL,EAAUC,OAAV,CAAkBN,OAAO,CAACO,IAA1B,MAAoC,CAAC,CAArC,GAAyC,MAAMP,OAAO,CAACO,IAAvD,GAA8D,EADvD,CAAT;AAIAN,EAAAA,QAAQ,CAACC,GAAT,CAAa,cAAb,EAA6B,MAA7B;AACAD,EAAAA,QAAQ,CAACC,GAAT,CAAa,eAAb,qBAA0C,KAAK,EAAL,GAAU,EAApD,yBAAqE,KAAK,EAAL,GAAU,EAAV,GAAe,GAApF;AAEAD,EAAAA,QAAQ,CAACO,IAAT,iaAU4BL,GAV5B;AAgBD","sourcesContent":["/**\n * @license\n * Copyright Â© 2017-2019 Moov Corporation.  All rights reserved.\n */\nexport default function powerLinkHandler(_params, request, response) {\n  response.set('content-type', 'application/javascript')\n\n  const src = `${request.protocol}//${request.hostname}${\n    [80, 443].indexOf(request.port) === -1 ? ':' + request.port : ''\n  }`\n\n  response.set('x-moov-cache', 'true')\n  response.set('cache-control', `max-age: ${60 * 60 * 24}, s-maxage: ${60 * 60 * 24 * 365}`)\n\n  response.send(`\n    var links = Array.from(document.querySelectorAll('a[data-rsf-power-link]')).map(function(link) {\n      var powerlink = link.getAttribute('href');\n      powerlink += (powerlink.indexOf('?') === -1 ? '?' : '&') + 'powerlink'\n      link.setAttribute('href', powerlink);\n      return link.getAttribute('href')\n    });\n\n    var el = document.createElement('iframe');\n\n    el.setAttribute('src', '${src}/pwa/install-service-worker.html?preload=' + encodeURIComponent(JSON.stringify(links)));\n    el.setAttribute('style', 'height:1px;width:1px;');\n    el.setAttribute('frameborder', '0');\n    \n    document.body.appendChild(el);\n  `)\n}\n"],"file":"powerLinkHandler.js"}